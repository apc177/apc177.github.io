<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="js/mui.js"></script>
		<link href="css/mui.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav header-bg">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">找回密码</h1>
		</header>
		<div class="mui-content">
			<div class="zhuce">
				<form class="mui-input-group">
					<div class="mui-input-row">
						<label>账　号：</label>
						<input type="text" class="mui-input-clear" placeholder="请输入您的账号">
					</div>
					<div class="mui-input-row">
						<label>验证码：</label>
						<input type="text" placeholder="请输入验证码">
						<button class="btn" id="send_code1">获取验证码</button>
					</div>
					<div class="mui-input-row">
						<label>新　密码：</label>
						<input type="password" class="mui-input-clear" placeholder="请输入您的新密码">
					</div>
					<div class="mui-input-row">
						<label>确认密码：</label>
						<input type="password" class="mui-input-clear" placeholder="请再次输入新密码">
					</div>
				</form>
			</div>
			<div class="zhuce-btn">
				<button id="btn4">修改密码</button>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="js/castapp.js"></script>
	<script>
		ca.init();
		var btn4=ca.id('btn4');
		var send_code=ca.id('send_code1');
		var input=ca.tagName('input');
		var code='';
		send_code.addEventListener('tap',function(){
			if(send_code.innerHTML!='获取验证码'){
				return;
			}
			var phone=input[0].value;
			code=ca.getIdCode(6);
			mui.post('http://' + ip + '/sendmail',{
					email:phone,
					code:code,
				},function(data){
					console.log(data)
					var num = 60;
					var timer= setInterval(function(){
						num--;
						if(num==0){
							send_code.innerHTML='获取验证码';
							clearInterval(timer);
						}
						else{
							send_code.innerHTML=num+'S';
						}
					},1000);
				},
			);
		})
		
		btn4.addEventListener('tap',function(){
			var phone=input['0'].value;
			var input_code=input['1'].value;
			var password=input['2'].value;
			var password1=input['3'].value;
			if(input_code==''){
				ca.prompt('验证码不能空');
				return;
			}
			if(input_code!=code){
				ca.prompt('验证码不正确');
				return;
			}
			if(password==''){
				ca.prompt('密码不能为空');
				return;
			}
			if(password1==''){
				ca.prompt('密码不能为空');
				return;
			}
			if(password!=password1){
				ca.prompt('两次密码不一致');
				return;
			}
			else
			updates(password,phone);
		})
		function updates(pwd,user){
			mui.post('http://' + ip + '/xiugai',{
					username:user,
					pwd:pwd,
				},function(data){
					console.log(data);
				},
			);
		}
	</script>

</html>
